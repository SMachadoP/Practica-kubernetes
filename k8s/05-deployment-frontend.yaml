# ====================================================
# DEPLOYMENT - Frontend (Nginx)
# ====================================================
# Este Deployment gestiona el frontend de la aplicación
# Nginx sirve archivos estáticos y hace proxy al backend
# ====================================================

apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend-deployment
  namespace: prackube
  labels:
    app: frontend
    tier: web
spec:
  replicas: 2               # 2 réplicas del frontend
  
  selector:
    matchLabels:
      app: frontend
  
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  
  template:
    metadata:
      labels:
        app: frontend
        tier: web
    spec:
      containers:
        - name: frontend
          image: prackube-frontend:latest
          imagePullPolicy: Never      # Usar imagen local de Minikube
          
          ports:
            - containerPort: 80
              protocol: TCP
              name: http
          
          # Recursos más ligeros para el frontend (solo sirve estáticos)
          resources:
            requests:
              memory: "32Mi"
              cpu: "50m"
            limits:
              memory: "128Mi"
              cpu: "200m"
          
          # Health checks para Nginx
          livenessProbe:
            httpGet:
              path: /nginx-health     # Endpoint configurado en nginx.conf
              port: 80
            initialDelaySeconds: 5
            periodSeconds: 10
            timeoutSeconds: 3
            failureThreshold: 3
          
          readinessProbe:
            httpGet:
              path: /nginx-health
              port: 80
            initialDelaySeconds: 3
            periodSeconds: 5
            timeoutSeconds: 2
            failureThreshold: 3
      
      terminationGracePeriodSeconds: 15
      restartPolicy: Always
